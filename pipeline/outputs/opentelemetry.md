—

== description: An output plugin to submit Logs, Metrics, or Traces to an OpenTelemetry endpoint

= OpenTelemetry

The OpenTelemetry plugin lets you take logs, metrics, and traces from Fluent Bit and submit them to an OpenTelemetry HTTP endpoint.

Only HTTP endpoints are supported.


| Key                                       | Description                                                                                                                                                                                                                                                                                                                            | Default                                                                         |
|-------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------|
| `add_label`                               | Lets you add custom labels to all metrics and logs (resource attributes) exposed through the OpenTelemetry exporter. You can have multiple `add_label` fields for each label you want to add.                                                                                                                                          | _none_                                                                          |
| `alias`                                   | Sets an alias for the output instance. This is useful when using multiple instances of the same output plugin. If no alias is set, the instance will be named using the plugin name and a sequence number.                                                                                                                             | _none_                                                                          |
| `aws_auth`                                | Enable AWS SigV4 authentication.                                                                                                                                                                                                                                                                                                       | `false`                                                                         |
| `aws_external_id`                         | Specify an external ID for the STS API, can be used with the `aws_role_arn` parameter if your role requires an external ID.                                                                                                                                                                                                            | _none_                                                                          |
| `aws_profile`                             | AWS Profile name. AWS Profiles can be configured with AWS CLI and are usually stored in $HOME/.aws/ directory.                                                                                                                                                                                                                         | _none_                                                                          |
| `aws_region`                              | AWS region of your service.                                                                                                                                                                                                                                                                                                            | _none_                                                                          |
| `aws_role_arn`                            | ARN of an IAM role to assume (ex. for cross account access).                                                                                                                                                                                                                                                                           | _none_                                                                          |
| `aws_service`                             | AWS destination service code, used by SigV4 authentication.                                                                                                                                                                                                                                                                            | `logs`                                                                          |
| `aws_sts_endpoint`                        | Custom endpoint for the AWS STS API, used with the `aws_role_arn` option.                                                                                                                                                                                                                                                              | _none_                                                                          |
| `batch_size`                              | Set the maximum number of log records to be flushed at a time.                                                                                                                                                                                                                                                                         | `1000`                                                                          |
| `compress`                                | Set payload compression mechanism. Options available are `gzip` and `zstd`.                                                                                                                                                                                                                                                            | _none_                                                                          |
| `grpc`                                    | Enables gRPC over an HTTP/2 connection. Supports `auto` option. This setting applies to HTTP/2 only.                                                                                                                                                                                                                                   | `off`                                                                           |
| `grpc_metrics_uri`                        | Specify an optional gRPC URI for the target OTel endpoint.                                                                                                                                                                                                                                                                             | `/opentelemetry.proto.collector.metrics.v1.MetricsService/Export`               |
| `grpc_logs_uri`                           | Specify an optional gRPCß URI for the target OTel endpoint.                                                                                                                                                                                                                                                                            | `/opentelemetry.proto.collector.logs.v1.LogsService/Export`                     |
| `grpc_traces_uri`                         | Specify an optional gRPC URI for the target OTel endpoint.                                                                                                                                                                                                                                                                             | `/opentelemetry.proto.collector.trace.v1.TraceService/Export`                   |
| `grpc_profiles_uri`                       | Specify an optional gRPC URI for the profiles OTel endpoint.                                                                                                                                                                                                                                                                           | `/opentelemetry.proto.collector.profiles.v1experimental.ProfilesService/Export` |
| `header`                                  | Add a HTTP header key/value pair. Multiple headers can be set.                                                                                                                                                                                                                                                                         | _none_                                                                          |
| `host`                                    | IP address or hostname of the target HTTP server.                                                                                                                                                                                                                                                                                      | `127.0.0.1`                                                                     |
| `http2`                                   | Defines whether HTTP/2 protocol is enabled. This setting also supports the `force` option, which forces HTTP/2 over a plain text connection.                                                                                                                                                                                           | `off`                                                                           |
| `http_passwd`                             | Basic Auth password. Requires `HTTP_user` to be set.                                                                                                                                                                                                                                                                                   | _none_                                                                          |
| `http_user`                               | Basic Auth username.                                                                                                                                                                                                                                                                                                                   | _none_                                                                          |
| `logs_attributes_metadata_key`            | Specify an `Attributes` key to look up in the metadata.                                                                                                                                                                                                                                                                                | `$Attributes`                                                                   |
| `log_level`                               | Specifies the log level for this output plugin. If not set, the plugin will use the global log level defined in the `service` section. If the global log level is also not specified, it uses default.                                                                                                                                 | `info`                                                                          |
| `log_suppress_interval`                   | Allows suppression of repetitive log messages from the output plugin that appear similar within a specified time interval. Default is no suppression.                                                                                                                                                                                  | `0`                                                                             |
| `logs_body_key`                           | The log body key to look up in the log events body/message. Sets the `Body` field of the OpenTelemetry logs data model.                                                                                                                                                                                                                | `message`                                                                       |
| `logs_body_key_attributes`                | When enabled (`true`), Fluent Bit will place all parsed JSON fields (except the one mapped by `logs_body_key`) inside the `attributes` section of the OpenTelemetry `LogRecord`. This is useful if you want structured key/value pairs as attributes, while still mapping a specific field (defined by `logs_body_key`) to the `body`. | `false`                                                                         |
| `logs_instrumentation_scope_metadata_key` | Specify an `InstrumentationScope` key.                                                                                                                                                                                                                                                                                                 | `InstrumentationScope`                                                          |
| `logs_metadata_key`                       | Set the key to lookup in the metadata.                                                                                                                                                                                                                                                                                                 | `otlp`                                                                          |
| `logs_observed_timestamp_metadata_key`    | Specify an `ObservedTimestamp` key to look up in the metadata.                                                                                                                                                                                                                                                                         | `$ObservedKey`                                                                  |
| `logs_resource_metadata_key`              | Specify a `Resource` key.                                                                                                                                                                                                                                                                                                              | `Resource`                                                                      |
| `log_response_payload`                    | Log the response payload within the Fluent Bit log.                                                                                                                                                                                                                                                                                    | `false`                                                                         |
| `log_severity_text_metadata_key`          | Specify a SeverityText key.                                                                                                                                                                                                                                                                                                            | `$SeverityText`                                                                 |
| `logs_severity_number_metadata_key`       | Specify a `SeverityNumber` key to look up in the metadata.                                                                                                                                                                                                                                                                             | `$SeverityNumber`                                                               |
| `logs_severity_number_message_key`        | The severity number id key to look up in the log events body/message. Sets the `SeverityNumber` field of the OpenTelemetry logs data model.                                                                                                                                                                                            | `$severityNumber`                                                               |
| `logs_severity_text_message_key`          | The severity text id key to look up in the log events body/message. Sets the `SeverityText` field of the OpenTelemetry logs data model.                                                                                                                                                                                                | `$SeverityText`                                                                 |
| `logs_span_id_message_key`                | The span id key to look up in the log events body/message. Sets the `SpanId` field of the OpenTelemetry logs data model.                                                                                                                                                                                                               | `$SpanId`                                                                       |
| `logs_span_id_metadata_key`               | Specify a `SpanId` key to look up in the metadata.                                                                                                                                                                                                                                                                                     | `$SpanId`                                                                       |
| `logs_timestamp_metadata_key`             | Specify a `Timestamp` key to look up in the metadata.                                                                                                                                                                                                                                                                                  | `$Timestamp`                                                                    |
| `logs_trace_flags_metadata_key`           | Specify a `TraceFlags` key to look up in the metadata.                                                                                                                                                                                                                                                                                 | `$TraceFlags`                                                                   |
| `logs_trace_id_message_key`               | The trace id key to look up in the log events body/message. Sets the `TraceId` field of the OpenTelemetry logs data model.                                                                                                                                                                                                             | `$TraceId`                                                                      |
| `logs_trace_id_metadata_key`              | Specify a `TraceId` key to look up in the metadata.                                                                                                                                                                                                                                                                                    | `$TraceId`                                                                      |
| `logs_uri`                                | Specify an optional HTTP URI for the target web server listening for logs, For example, `/v1/logs`.                                                                                                                                                                                                                                    | _none_                                                                          |
| `match`                                   | Set a tag pattern to match the records that this output should process. Supports exact matches or wildcards (for example '*').                                                                                                                                                                                                         | `default`                                                                       |
| `match_regex`                             | Set a regular expression to match tags for output routing. This allows more flexible matching compared to simple wildcards.                                                                                                                                                                                                            | `default`                                                                       |
| `metrics_uri`                             | Specify an optional HTTP URI for the target web server listening for metrics. For example, `/v1/metrics`.                                                                                                                                                                                                                              | `/`                                                                             |
| `net.connect_timeout`                     | Set maximum time allowed to establish a connection, this time includes the TLS handshake.                                                                                                                                                                                                                                              | `10s`                                                                           |
| `net.connect_timeout_log_error`           | On connection timeout, specify if it should log an error. When disabled, the timeout is logged as a debug message.                                                                                                                                                                                                                     | `true`                                                                          |
| `net.keepalive_max_recycle`               | Set maximum number of times a keepalive connection can be used before it is retried.                                                                                                                                                                                                                                                   | `2000`                                                                          |
| `net.dns.mode`                            | Select the primary DNS connection type (TCP or UDP).                                                                                                                                                                                                                                                                                   | _none_                                                                          |
| `net.dns.prefer_ipv4`                     | Select the primary DNS resolver type (LEGACY or ASYNC).                                                                                                                                                                                                                                                                                | _none_                                                                          |
| `net.dns.prefer_ipv6`                     | Prioritize IPv6 DNS results when trying to establish a connection.                                                                                                                                                                                                                                                                     | _none_                                                                          |
| `net.io_timeout`                          | Set maximum time a connection can stay idle while assigned.                                                                                                                                                                                                                                                                            | `0s`                                                                            |
| `net.max_worker_connections`              | Set the maximum number of active TCP connections that can be used per worker thread.                                                                                                                                                                                                                                                   | `0`                                                                             |
| `net.proxy_env_ignore`                    | Ignore the environment variables `HTTP_PROXY`, `HTTPS_PROXY` and `NO_PROXY` when set.                                                                                                                                                                                                                                                  | `false`                                                                         |
| `net.source_address`                      | Specify network address to bind for data traffic.                                                                                                                                                                                                                                                                                      | _none_                                                                          |
| `net.tcp_keepalive`                       | Enable or disable Keepalive support.                                                                                                                                                                                                                                                                                                   | `off`                                                                           |
| `net.tcp_keepalive_time`                  | Interval between the last data packet sent and the first TCP keepalive probe.                                                                                                                                                                                                                                                          | `-1`                                                                            |
| `net.tcp_keepalive_interval`              | Interval between TCP keepalive probes when no response is received on a keepidle probe.                                                                                                                                                                                                                                                | `-1`                                                                            |
| `net.tcp_keepalive_probes`                | Number of unacknowledged probes to consider a connection dead.                                                                                                                                                                                                                                                                         | `-1`                                                                            |
| `port`                                    | TCP port of the target HTTP server.                                                                                                                                                                                                                                                                                                    | `80`                                                                            |
| `profiles_uri`                            | Specify an optional HTTP URI for the profiles OTel endpoint.                                                                                                                                                                                                                                                                           | `/v1development/profiles`                                                       |
| `proxy`                                   | Specify an HTTP Proxy. The expected format value is `http://HOST:PORT`. HTTPS isn't supported. It's recommended to configure the [HTTP proxy environment variables](https://docs.fluentbit.io/manual/administration/http-proxy) instead as they support both HTTP and HTTPS.                                                           | _none_                                                                          |
| `retry_limit`                             | Set the retry limit for the output plugin when delivery fails. Accepted values: a positive integer, `no_limits`, `false`, or `off` to disable retry limits, or `no_retries` to disable retries entirely.                                                                                                                               | `1`                                                                             |
| `tls`                                     | Enable or disable TLS/SSL support.                                                                                                                                                                                                                                                                                                     | `off`                                                                           |
| `tls.ca_file`                             | Absolute path to CA certificate file.                                                                                                                                                                                                                                                                                                  | `default`                                                                       |
| `tls.ca_path`                             | Absolute path to scan for certificate files.                                                                                                                                                                                                                                                                                           | `default`                                                                       |
| `tls.cert_file`                           | Absolute path to Certificate file.                                                                                                                                                                                                                                                                                                     | `default`                                                                       |
| `tls.ciphers`                             | Specify TLS ciphers up to TLSv1.2.                                                                                                                                                                                                                                                                                                     | `default`                                                                       |
| `tls.debug`                               | Set TLS debug verbosity level. It accept the following values: `0` (No debug), `1`(Error), `2` (State change), `3` (Informational) and `4` (Verbose).                                                                                                                                                                                  | `1`                                                                             |
| `tls.key_file`                            | Absolute path to private Key file.                                                                                                                                                                                                                                                                                                     | `default`                                                                       |
| `tls.key_passwd`                          | Optional password for tls.key_file file.                                                                                                                                                                                                                                                                                               | `default`                                                                       |
| `tls.max_version`                         | Specify the maximum version of TLS.                                                                                                                                                                                                                                                                                                    | `default`                                                                       |
| `tls.min_version`                         | Specify the minimum version of TLS.                                                                                                                                                                                                                                                                                                    | `default`                                                                       |
| `tls.verify`                              | Force certificate validation.                                                                                                                                                                                                                                                                                                          | `on`                                                                            |
| `tls.verify_hostname`                     | Enable or disable to verify hostname.                                                                                                                                                                                                                                                                                                  | `off`                                                                           |
| `tls.vhost`                               | Hostname to be used for TLS SNI extension.                                                                                                                                                                                                                                                                                             | `default`                                                                       |
| `tls.windows.certstore_name`              | Sets the certstore name on an output (Windows).                                                                                                                                                                                                                                                                                        | `default`                                                                       |
| `tls.windows.use_enterprise_store`        | Sets whether using enterprise certstore or not on an output (Windows).                                                                                                                                                                                                                                                                 | `default`                                                                       |
| `traces_uri`                              | Specify an optional HTTP URI for the target web server listening for traces, For example, `/v1/traces`.                                                                                                                                                                                                                                | `/`                                                                             |


== Get started

The OpenTelemetry plugin works with logs and only the metrics collected from one of the metric input plugins. In the following example, log records generated by the dummy plugin and the host metrics collected by the node exporter metrics plugin are exported by the OpenTelemetry output plugin.

{% tabs %}
{% tab title="fluent-bit.yaml" %}

[source,yaml]
----
# Dummy Logs and traces with Node Exporter Metrics export using OpenTelemetry output plugin
# -------------------------------------------
# The following example collects host metrics on Linux and dummy logs and traces and delivers
# them through the OpenTelemetry plugin to a local collector :
#
service:
  flush: 1
  log_level: info

pipeline:
  inputs:
    - name: node_exporter_metrics
      tag: node_metrics
      scrape_interval: 2

    - name: dummy
      tag: dummy.log
      rate: 3

    - name: event_type
      type: traces

  outputs:
    - name: opentelemetry
      match: "*"
      host: localhost
      port: 443
      metrics_uri: /v1/metrics
      logs_uri: /v1/logs
      traces_uri: /v1/traces
      log_response_payload: true
      tls: on
      tls.verify: off
      logs_body_key: $message
      logs_span_id_message_key: span_id
      logs_trace_id_message_key: trace_id
      logs_severity_text_message_key: loglevel
      logs_severity_number_message_key: lognum
      # add user-defined labels
      add_label:
        - app fluent-bit
        - color blue
----

{% endtab %}
{% tab title="fluent-bit.conf" %}

[source,text]
----
# Dummy Logs and traces with Node Exporter Metrics export using OpenTelemetry output plugin
# -------------------------------------------
# The following example collects host metrics on Linux and dummy logs and traces and delivers
# them through the OpenTelemetry plugin to a local collector :
#
[SERVICE]
  Flush                1
  Log_level            info

[INPUT]
  Name                 node_exporter_metrics
  Tag                  node_metrics
  Scrape_interval      2

[INPUT]
  Name                 dummy
  Tag                  dummy.log
  Rate                 3

[INPUT]
  Name                 event_type
  Type                 traces

[OUTPUT]
  Name                 opentelemetry
  Match                *
  Host                 localhost
  Port                 443
  Metrics_uri          /v1/metrics
  Logs_uri             /v1/logs
  Traces_uri           /v1/traces
  Log_response_payload True
  Tls                  On
  Tls.verify           Off
  logs_body_key $message
  logs_span_id_message_key span_id
  logs_trace_id_message_key trace_id
  logs_severity_text_message_key loglevel
  logs_severity_number_message_key lognum
  # add user-defined labels
  add_label            app fluent-bit
  add_label            color blue
----

{% endtab %}
{% endtabs %}
